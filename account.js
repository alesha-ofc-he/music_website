const translations = {
    rus: {
        account: "Аккаунт",
        accountSettings: "Настройки аккаунта",
        editProfile: "Редактировать профиль",
        signOut: "Выйти",
        updateProfile: "Обновить профиль",
        name: "Имя",
        surname: "Фамилия",
        email: "Электронная почта",
        age: "Возраст",
        newPassword: "Новый пароль",
        confirmNewPassword: "Подтвердите новый пароль",
        faq: "Часто задаваемые вопросы",
        faqQuestion1: "Как изменить пароль?",
        faqAnswer1: "Чтобы изменить пароль, перейдите в настройки аккаунта и выберите 'Изменить пароль'. Следуйте инструкциям, чтобы ввести текущий пароль и установить новый.",
        faqQuestion2: "Могу ли я скачивать музыку для прослушивания офлайн?",
        faqAnswer2: "Да, премиум-подписчики могут скачивать музыку для прослушивания офлайн. Ищите значок загрузки рядом с песнями, альбомами или плейлистами.",
        faqQuestion3: "Как отменить подписку?",
        faqAnswer3: "Не-а.<br>Ты остаешься с нами, малыш. Навсегда.",
        contactSupport: "Связаться с поддержкой",
        subject: "Тема",
        selectSubject: "Выберите тему",
        accountIssues: "Проблемы с аккаунтом",
        billingInquiries: "Вопросы по оплате",
        technicalSupport: "Техническая поддержка",
        feedback: "Отзыв",
        other: "Другое",
        message: "Сообщение",
        sendMessage: "Отправить сообщение",
        successMessage: "Ваше сообщение успешно отправлено. Мы скоро свяжемся с вами!",
        footerCredit: "Страница создана Алиханом ИТ-2307",
        date: "Дата:",
        collections: "Коллекции",
        fillAllFields: "Пожалуйста, заполните все поля",
        invalidEmail: "Пожалуйста, введите корректный email адрес",
        passwordTooShort: "Пароль должен содержать минимум 8 символов",
        passwordsDoNotMatch: "Пароли не совпадают",
        profileUpdated: "Профиль успешно обновлен"
    },
    kaz: {
        account: "Аккаунт",
        accountSettings: "Аккаунт параметрлері",
        editProfile: "Профильді өңдеу",
        signOut: "Шығу",
        updateProfile: "Профильді жаңарту",
        name: "Аты",
        surname: "Тегі",
        email: "Электрондық пошта",
        age: "Жасы",
        newPassword: "Жаңа құпия сөз",
        confirmNewPassword: "Жаңа құпия сөзді растаңыз",
        faq: "Жиі қойылатын сұрақтар",
        faqQuestion1: "Құпия сөзді қалай өзгертуге болады?",
        faqAnswer1: "Құпия сөзді өзгерту үшін аккаунт параметрлеріне өтіп, 'Құпия сөзді өзгерту' опциясын таңдаңыз. Ағымдағы құпия сөзді енгізу және жаңасын орнату үшін нұсқауларды орындаңыз.",
        faqQuestion2: "Музыканы офлайн тыңдау үшін жүктеп алуға бола ма?",
        faqAnswer2: "Иә, премиум жазылушылар музыканы офлайн тыңдау үшін жүктей алады. Әндердің, альбомдардың немесе ойнату тізімдерінің жанындағы жүктеу белгішесін іздеңіз.",
        faqQuestion3: "Жазылымды қалай болдырмауға болады?",
        faqAnswer3: "Жоқ.<br>Сен бізбен қаласың, кішкентай. Мәңгі.",
        contactSupport: "Қолдау қызметіне хабарласу",
        subject: "Тақырып",
        selectSubject: "Тақырыпты таңдаңыз",
        accountIssues: "Аккаунт мәселелері",
        billingInquiries: "Төлем сұрақтары",
        technicalSupport: "Техникалық қолдау",
        feedback: "Кері байланыс",
        other: "Басқа",
        message: "Хабарлама",
        sendMessage: "Хабарламаны жіберу",
        successMessage: "Сіздің хабарламаңыз сәтті жіберілді. Біз жақын арада сізбен байланысамыз!",
        footerCredit: "Бетті Әлихан ИТ-2307 жасады",
        date: "Күні:",
        collections: "Жинақтар",
        fillAllFields: "Барлық өрістерді толтырыңыз",
        invalidEmail: "Жарамды электрондық пошта мекенжайын енгізіңіз",
        passwordTooShort: "Құпия сөз кемінде 8 таңбадан тұруы керек",
        passwordsDoNotMatch: "Құпия сөздер сәйкес келмейді",
        profileUpdated: "Профиль сәтті жаңартылды"
    },
    eng: {
        account: "Account",
        accountSettings: "Account Settings",
        editProfile: "Edit your profile",
        signOut: "Sign out",
        updateProfile: "Update Profile",
        name: "Name",
        surname: "Surname",
        email: "Email",
        age: "Age",
        newPassword: "New Password",
        confirmNewPassword: "Confirm New Password",
        faq: "Frequently Asked Questions",
        faqQuestion1: "How do I change my password?",
        faqAnswer1: "To change your password, go to your account settings and select 'Change Password'. Follow the prompts to enter your current password and set a new one.",
        faqQuestion2: "Can I download music for offline listening?",
        faqAnswer2: "Yes, premium subscribers can download music for offline listening. Look for the download icon next to songs, albums, or playlists.",
        faqQuestion3: "How do I cancel my subscription?",
        faqAnswer3: "Nah uh.<br>You stay with us little one. Forever.",
        contactSupport: "Contact Support",
        subject: "Subject",
        selectSubject: "Select a subject",
        accountIssues: "Account Issues",
        billingInquiries: "Billing Inquiries",
        technicalSupport: "Technical Support",
        feedback: "Feedback",
        other: "Other",
        message: "Message",
        sendMessage: "Send Message",
        successMessage: "Your message has been sent successfully. We'll get back to you soon!",
        footerCredit: "Page created by Alikhan IT-2307",
        date: "Date:",
        collections: "Collections",
        fillAllFields: "Please fill in all fields",
        invalidEmail: "Please enter a valid email address",
        passwordTooShort: "Password must be at least 8 characters long",
        passwordsDoNotMatch: "Passwords do not match",
        profileUpdated: "Profile updated successfully"
    }
};

function changeLanguage(language) {
    const elements = document.querySelectorAll('[data-translate]');
    elements.forEach(element => {
        const key = element.getAttribute('data-translate');
        if (translations[language] && translations[language][key]) {
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                element.placeholder = translations[language][key];
            } else {
                element.textContent = translations[language][key];
            }
        }
    });
    saveUserPreferences('language', language);
}

function loadUserPreferences() {
    const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
    if (loggedInUser) {
        return {
            language: loggedInUser.language || 'eng',
            darkMode: loggedInUser.darkMode || false
        };
    }
    return {
        language: JSON.parse(localStorage.getItem('language')) || 'eng',
        darkMode: JSON.parse(localStorage.getItem('darkMode')) || false
    };
}

function saveUserPreferences(key, value) {
    const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
    if (loggedInUser) {
        loggedInUser[key] = value;
        localStorage.setItem('loggedInUser', JSON.stringify(loggedInUser));
    }
    localStorage.setItem(key, JSON.stringify(value));
}

function loadUserData() {
    const userData = JSON.parse(localStorage.getItem('userData'));
    if (userData) {
        document.getElementById('accountInfo').innerHTML = `
            <div class="d-flex align-items-center mb-4">
                <img class="account-photo me-3" src="images/accountmertay.jpg" alt="User Photo">
                <div>
                    <h2 class="account-name mb-0">${userData.name} ${userData.surname}</h2>
                    <p class="account-email mb-0">${userData.email}</p>
                    <p class="mb-0"><span data-translate="age">Age</span>: ${userData.age}</p>
                </div>
            </div>
        `;
        document.getElementById('name').value = userData.name;
        document.getElementById('surname').value = userData.surname;
        document.getElementById('email').value = userData.email;
        document.getElementById('age').value = userData.age;
    } else {
        window.location.href = 'home.html'; // Redirect to home if not logged in
    }
}

document.getElementById('profileForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const name = document.getElementById('name').value;
    const surname = document.getElementById('surname').value;
    const email = document.getElementById('email').value;
    const age = document.getElementById('age').value;
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirmPassword').value;

    const currentLanguage = loadUserPreferences().language;

    if (!name || !surname || !email || !age) {
        alert(translations[currentLanguage].fillAllFields);
        return;
    }

    if (!isValidEmail(email)) {
        alert(translations[currentLanguage].invalidEmail);
        return;
    }

    if (password && password.length < 8) {
        alert(translations[currentLanguage].passwordTooShort);
        return;
    }

    if (password !== confirmPassword) {
        alert(translations[currentLanguage].passwordsDoNotMatch);
        return;
    }

    const userData = JSON.parse(localStorage.getItem('userData'));
    userData.name = name;
    userData.surname = surname;
    userData.email = email;
    userData.age = age;
    if (password) {
        userData.password = password;
    }
    localStorage.setItem('userData', JSON.stringify(userData));

    alert(translations[currentLanguage].profileUpdated);
    loadUserData();
    document.getElementById('updateProfileSection').style.display = 'none';
});

document.querySelectorAll('.faq-question').forEach(question => {
    question.addEventListener('click', () => {
        const answer = question.nextElementSibling;
        answer.style.display = answer.style.display === 'block' ? 'none' : 'block';
    });
});

const popup = document.getElementById('contactPopup');
const showPopupBtn = document.getElementById('showPopupBtn');
const closePopup = document.querySelector('.close-popup');
const contactForm = document.getElementById('contactForm');
const successMessage = document.getElementById('successMessage');

showPopupBtn.addEventListener('click', () => {
    popup.style.display = 'flex';
});

closePopup.addEventListener('click', () => {
    popup.style.display = 'none';
    resetForm();
});

window.addEventListener('click', (e) => {
    if (e.target === popup) {
        popup.style.display = 'none';
        resetForm();
    }
});

contactForm.addEventListener('submit', function(e) {
    e.preventDefault();
    if (validateForm()) {
        setTimeout(() => {
            this.style.display = 'none';
            successMessage.style.display = 'block';
            setTimeout(() => {
                popup.style.display = 'none';
                resetForm();
            }, 3000);
        }, 1000);
    }
});

function validateForm() {
    const name = document.getElementById('contactName').value.trim();
    const email = document.getElementById('contactEmail').value.trim();
    const subject = document.getElementById('contactSubject').value;
    const message = document.getElementById('contactMessage').value.trim();
    const currentLanguage = loadUserPreferences().language;
    if (!name || !email || !subject || !message) {
        alert(translations[currentLanguage].fillAllFields);
        return false;
    }
    if (!isValidEmail(email)) {
        alert(translations[currentLanguage].invalidEmail);
        return false;
    }
    return true;
}

function isValidEmail(email) {
    const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    return re.test(String(email).toLowerCase());
}

function resetForm() {
    contactForm.reset();
    contactForm.style.display = 'block';
    successMessage.style.display = 'none';
}

document.getElementById('editProfileBtn').addEventListener('click', function() {
    const updateProfileSection = document.getElementById('updateProfileSection');
    updateProfileSection.style.display = updateProfileSection.style.display === 'none' ? 'block' : 'none';
});

document.getElementById('signOutBtn').addEventListener('click', function() {
    localStorage.removeItem('loggedInUser');
    window.location.href = 'home.html';
});

function toggleTheme() {
    document.body.classList.toggle('dark-mode');
    const isDarkMode = document.body.classList.contains('dark-mode');
    saveUserPreferences('darkMode', isDarkMode);
    updateThemeToggle();
}

function updateThemeToggle() {
    const themeToggle = document.getElementById('themeToggle');
    const isDarkMode = document.body.classList.contains('dark-mode');
    themeToggle.innerHTML = isDarkMode ? '<i class="bi bi-sun-fill text-white"></i>' : '<i class="bi bi-moon-fill text-white"></i>';
}

document.addEventListener('DOMContentLoaded', function() {
    loadUserData();
    const preferences = loadUserPreferences();
    changeLanguage(preferences.language);
    if (preferences.darkMode) {
        document.body.classList.add('dark-mode');
    }
    updateThemeToggle();

    const today = new Date();
    document.getElementById('currentDate').textContent = today.toLocaleDateString();
});

document.getElementById('themeToggle').addEventListener('click', toggleTheme);